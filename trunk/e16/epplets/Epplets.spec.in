%define	name	epplets
%define	dname	@PACKAGE@
%define	fname	@PACKAGE@
%define	version	@VERSION@
%define	release	1
%define	serial	2
%define	prefix	/usr

%define	deroot	%{prefix}/share/enlightenment
%define	debin	%{prefix}/bin

Summary:	Applets for enlightenment.
Name:		%{name}
Version:	%{version}
Release:	%{release}
Serial:		%{serial}
Prefix:		%{prefix}
Copyright:	GPL
Group:		User Interface/Desktops
URL:		http://www.enlightenment.org
Vendor:		http://www.enlightenment.org
Source:		ftp://ftp.enlightenment.org/enlightenment/epplets/%{fname}-%{version}.tar.gz
BuildRoot:	/var/tmp/%{name}-%{version}

Conflicts:	Epplets
Requires:	enlightenment >= 0.16.0, epplets-base = %{version}

Distribution:	Freshmeat RPMs
Packager:	Ryan Weaver <ryanw@infohwy.com>

%description
An epplet is an applet designed specificly for use with enlightenment
This packages contains several epplets; two cpu load meters, two clocks,
a network load monitor, aswell as a E-Biff

%package	base
Summary:	Core API libs for epplets.
Group:		System Environment/Libraries
Conflicts:	epplet-base

%description	base
An epplet is an applet designed specificly for use with enlightenment
This packages contains the core API libs and headers for building epplets.

%prep
%setup -q -n %{dname}-%{version}

%build
if [ -z $EROOT ]; then EROOT=%{deroot}; export EROOT; fi
if [ -z $EBIN ]; then EBIN=%{debin}; export EBIN; fi

if [ -z $GNOME_FRIENDLY ]; then
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{prefix}
else
CFLAGS="$RPM_OPT_FLAGS" ./configure --prefix=%{prefix} --disable-autorespawn
fi

make

%install
if [ -d $RPM_BUILD_ROOT ]; then rm -rf $RPM_BUILD_ROOT; fi
mkdir -p $RPM_BUILD_ROOT

if [ -z $EROOT ]; then EROOT=%{deroot}; export EROOT; fi
if [ -z $EBIN ]; then EBIN=%{debin}; export EBIN; fi

make DESTDIR=$RPM_BUILD_ROOT install

# Make all the aircut3.ttf and bg.png files symlinks to 1 of each.
(
	for i in `find $RPM_BUILD_ROOT$EROOT/epplet_data -name aircut3.ttf`; do
		ln -fs ../../aircut3.ttf $i;
	done
	install -m 644 epplets/E-Cpu.ABOUT/aircut3.ttf $RPM_BUILD_ROOT$EROOT/epplet_data
	for i in `find $RPM_BUILD_ROOT$EROOT/epplet_data -name bg.png`; do
		ln -fs ../../bg.png $i;
	done
	install -m 644 epplets/E-Cpu.ABOUT/bg.png $RPM_BUILD_ROOT$EROOT/epplet_data
)

## Build File List
if [ -e epplets-files ]; then rm epplets-files; fi
if [ -e epplets-files.base ]; then rm epplets-files.base; fi

echo '%defattr(-,root,root)'	     > epplets-files
echo '%doc ChangeLog'		    >> epplets-files
echo "$EBIN/*.epplet"		    >> epplets-files
echo "%dir $EROOT/epplet_data"	    >> epplets-files
echo "$EROOT/epplet_data/*"	    >> epplets-files
echo "%dir $EROOT/epplet_icons"	    >> epplets-files
echo "$EROOT/epplet_icons/*"	    >> epplets-files

echo '%defattr(-,root,root)'	     > epplets-files.base
echo "%{prefix}/lib/libepplet.so.*" >> epplets-files.base
echo "%{prefix}/include/epplet.h"   >> epplets-files.base
echo "%{prefix}/lib/libepplet.a"    >> epplets-files.base
echo "%{prefix}/lib/libepplet.so"   >> epplets-files.base

%post	base -p /sbin/ldconfig
%postun	base -p /sbin/ldconfig

%clean
if [ -d $RPM_BUILD_ROOT ]; then rm -rf $RPM_BUILD_ROOT; fi
if [ -e epplets-files ]; then rm epplets-files; fi
if [ -e epplets-files.base ]; then rm epplets-files.base; fi

%files		-f epplets-files
%files	base	-f epplets-files.base

%changelog

