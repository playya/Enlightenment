AC_INIT(Makefile.am)

ELOGIN_MAJOR=0
ELOGIN_MINOR=1
ELOGIN_MICRO=0
ELOGIN_VERSION=$ELOGIN_MAJOR.$ELOGIN_MINOR.$ELOGIN_MICRO

VERSION=$ELOGIN_VERSION
PACKAGE=elogin

AM_INIT_AUTOMAKE($PACKAGE, $VERSION)

if test "x$prefix" = "xNONE"; then
  prefix="/usr/local"
fi

AM_CONFIG_HEADER(config.h)

AC_DEFINE_UNQUOTED(ELOGIN_VERSION, "$ELOGIN_VERSION")
AC_SUBST(ELOGIN_VERSION)
AC_DEFINE_UNQUOTED(ELOGIN_MAJOR, "$ELOGIN_MAJOR")
AC_SUBST(ELOGIN_MAJOR)
AC_DEFINE_UNQUOTED(ELOGIN_MINOR, "$ELOGIN_MINOR")
AC_SUBST(ELOGIN_MINOR)
AC_DEFINE_UNQUOTED(ELOGIN_MICRO, "$ELOGIN_MICRO")
AC_SUBST(ELOGIN_MICRO)

AC_SUBST(ELOGIN_ROOT)
AC_SUBST(ELOGIN_BIN)

DATA_DIR=`eval eval eval eval eval echo "${datadir}/${PACKAGE}"`
AC_DEFINE_UNQUOTED(DATA_DIR, "$DATA_DIR")
AC_DEFINE_UNQUOTED(PACKAGE,"$PACKAGE")
AC_DEFINE_UNQUOTED(VERSION,"$VERSION")
AC_SUBST(PACKAGE)
AC_SUBST(VERSION)

ALL_LINGUAS="en_US"

AC_PROG_CC
AM_PROG_CC_STDC
AC_PROG_INSTALL
AC_HEADER_STDC

AC_PATH_X
AC_PATH_XTRA

ELOGIN_ROOT=${prefix}/elogin
ELOGIN_BIN=${prefix}/elogin/bin

AC_CHECK_LIB(Imlib2, imlib_context_set_visual,,AC_MSG_ERROR(Cannot find
Imlib2.))
LIBS="$LIBS"
AC_CHECK_HEADER(Imlib2.h,,AC_MSG_ERROR(Cannot find Imlib2 header files.))

AC_CHECK_HEADERS(freetype.h freetype/freetype.h,[ break] , )
AC_CHECK_LIB(ttf, TT_Init_FreeType, TTF_LIBS=-lttf, [
echo "ERROR: Elogin needs a system with libttf.so (TrueType Font Library)"
echo "You can obtain it from:"
echo "ftp://ftp.enlightenment.org/pub/enlightenment/"
echo "ftp://www.rasterman.com/pub/enlightenment/"
echo "You can also obtain it from:"
echo "http://www.freetype.org/"
echo "You can obtain some truetype fonts from:"
echo "http://voyager.cns.ohiou.edu/~sadkins/web_library/fonts/font_archive/"
AC_MSG_ERROR([Fatal Error: no FreeType detected.])], -lm)
AC_SUBST(TTF_LIBS)

AC_CHECK_LIB(dl, dlopen, DL_LIBS=-ldl , [
echo "Warning: Elogin requires the dl (dynamic loader) library"
echo "to be supported on your platform for module support.  Modules"
echo "have been disabled (this will affect functionality)"
AC_MSG_WARN([Module Support Disabled (no dynamic loader)])], -lm)
AC_SUBST(DL_LIBS)

AC_CHECK_LIB(Xinerama, XineramaQueryExtension, AC_DEFINE(HAS_XINERAMA)
		XINERAMA_LIBS=-lXinerama
		, ,$X_LIBS)

CFLAGS="$CFLAGS"
LIBS="$LIBS"

AC_SUBST(CFLAGS)
AC_SUBST(XINERAMA_LIBS)
AC_SUBST(LIBS)
AC_SUBST(ELOGIN_ROOT)
AC_SUBST(ELOGIN_BIN)

AC_OUTPUT([
Makefile
src/Makefile
])
