# get rid of that stupid cache mechanism
rm -f config.cache

AC_INIT(configure.in)
AC_CANONICAL_BUILD
AC_CANONICAL_HOST
AC_ISC_POSIX
AM_INIT_AUTOMAKE(etk, 0.1.0.001)
AM_CONFIG_HEADER(config.h)

AC_C_BIGENDIAN
AC_PROG_CC
AM_PROG_CC_STDC
AC_HEADER_STDC
AC_C_CONST
AM_ENABLE_SHARED
AM_PROG_LIBTOOL

dnl Add the languages which your application supports here.

if test "x${bindir}" = 'x${exec_prefix}/bin'; then
  if test "x${exec_prefix}" = "xNONE"; then
    if test "x${prefix}" = "xNONE"; then
      bindir="${ac_default_prefix}/bin";
    else
      bindir="${prefix}/bin";
    fi
  else
    if test "x${prefix}" = "xNONE"; then
      bindir="${ac_default_prefix}/bin";
    else
      bindir="${prefix}/bin";
    fi
  fi
fi

if test "x${libdir}" = 'x${exec_prefix}/lib'; then
  if test "x${exec_prefix}" = "xNONE"; then
    if test "x${prefix}" = "xNONE"; then
      libdir="${ac_default_prefix}/lib";
    else
      libdir="${prefix}/lib";
    fi
  else
    if test "x${prefix}" = "xNONE"; then
      libdir="${ac_default_prefix}/lib";
    else
      libdir="${prefix}/lib";
    fi
  fi
fi

dnl Set PACKAGE_DATA_DIR in config.h.
if test "x${datadir}" = 'x${prefix}/share'; then
  if test "x${prefix}" = "xNONE"; then
    AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${ac_default_prefix}/share/${PACKAGE}", [Shared Data Directory])
  else
    AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${prefix}/share/${PACKAGE}", [Shared Data Directory])
  fi
else
  AC_DEFINE_UNQUOTED(PACKAGE_DATA_DIR, "${datadir}/${PACKAGE}", [Shared Data Directory])
fi

dnl Set PACKAGE_BIN_DIR in config.h.
if test "x${bindir}" = 'xNONE'; then
  if test "x${prefix}" = "xNONE"; then
    AC_DEFINE_UNQUOTED(PACKAGE_BIN_DIR, "${ac_default_prefix}/bin", [Installation Directory for User Executables])
  else
    AC_DEFINE_UNQUOTED(PACKAGE_BIN_DIR, "${prefix}/bin", [Installation Directory for User Executables])
  fi
else
  AC_DEFINE_UNQUOTED(PACKAGE_BIN_DIR, "${bindir}", [Installation Directory for User Executables])
fi

dnl Set PACKAGE_LIB_DIR in config.h.
if test "x${libdir}" = 'xNONE'; then
  if test "x${prefix}" = "xNONE"; then
    AC_DEFINE_UNQUOTED(PACKAGE_LIB_DIR, "${ac_default_prefix}/lib", [Installation Directory for Libraries])
  else
    AC_DEFINE_UNQUOTED(PACKAGE_LIB_DIR, "${prefix}/lib", [Installation Directory for Libraries])
  fi
else
  AC_DEFINE_UNQUOTED(PACKAGE_LIB_DIR, "${libdir}", [Installation Directory for Libraries])
fi

dnl Set PACKAGE_SOURCE_DIR in config.h.
packagesrcdir=`cd $srcdir && pwd`
AC_DEFINE_UNQUOTED(PACKAGE_SOURCE_DIR, "${packagesrcdir}", [Source Code Directory])

case "$host_os" in
    *bsd*)
       AC_DEFINE(HAVE_BSD, [], "Have a BSD distribution")
    ;;
    linux*)
       AC_DEFINE(HAVE_LINUX, [], "Have a Linux distribution")
    ;;
esac

function vser
{
  v=$1
  VSTART=`echo $v | awk -F_ '{printf("%s", $1);}'`
  V1=`echo $VSTART | awk -F\. '{printf("%s", $1);}'`
  V2=`echo $VSTART | awk -F\. '{printf("%s", $2);}'`
  V3=`echo $VSTART | awk -F\. '{printf("%s", $3);}'`
  V4="0"
  VEND=`echo $v | awk -F_ '{printf("%s", $2);}'`
  if test -n "$VEND"; then
    V4=`echo $VEND | sed s/pre//`
  fi
  V3=$(( $V3 * 100  ));
  V2=$(( $V2 * 10000  ));
  V1=$(( $V1 * 1000000  ));
  V=$(( $V4 + $V3 + $V2 + $V1 ));
  echo $V
}

AC_PATH_GENERIC(evas, 0.9.9,
  [ ],
  [
    echo "ERROR:"
    echo "The evas-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the evas-devel (or evas-dev)"
    echo "   packages."
    echo "2. You may have evas installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the evas-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-evas-config."
    AC_MSG_ERROR([Fatal Error: no evas-config detected.])
  ]
)

AC_PATH_GENERIC(ecore, 0.9.9,
  [ ],
  [
    echo "ERROR:"
    echo "The ecore-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the ecore-devel (or ecore-dev)"
    echo "   packages."
    echo "2. You may have ecore installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the ecore-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-ecore-config."
    AC_MSG_ERROR([Fatal Error: no ecore-config detected.])
  ]
)

CFLAGS=$ECORE_CFLAGS" "$CFLAGS
AC_PATH_GENERIC(edje, 0.5.0,
  [ ],
  [
    echo "ERROR:"
    echo "The edje-config development script was not found in your execute"
    echo "path. This may mean one of several things"
    echo "1. You may not have installed the edje-devel (or edje-dev)"
    echo "   packages."
    echo "2. You may have edje installed somewhere not covered by your path."
    echo ""
    echo "If this is the case make sure you have the packages installed, AND"
    echo "that the edje-config script is in your execute path (see your"
    echo "shell's manual page on setting the \$PATH environment variable), OR"
    echo "alternatively, specify the script to use with --with-edje-config."
    AC_MSG_ERROR([Fatal Error: no edje-config detected.])
  ]
)

#####################################################################
## Ecore_X
have_ecore_x="no"
save_CPPFLAGS=$CPPFLAGS
CPPFLAGS="$CPPFLAGS $ECORE_CFLAGS"
save_LDFLAGS=$LDFLAGS
LDFLAGS="$LDFLAGS $ECORE_LIBS"
AC_CHECK_HEADER(Ecore_X.h,
  [AC_CHECK_LIB(ecore_x,
      ecore_x_init,
     [AC_DEFINE(HAVE_ECORE_X,
         1,
         [Define to 1 if you have the Ecore_X headers and libraries])
      have_ecore_x="yes"],
     [AC_DEFINE(HAVE_ECORE_X,
         0,
         [Define to 1 if you have the Ecore_X headers and libraries])])],
  [AC_DEFINE(HAVE_ECORE_X,
      0,
      [Define to 1 if you have the Ecore_X headers and libraries])]
)
CPPFLAGS=$save_CPPFLAGS
LDFLAGS=$save_LDFLAGS

#####################################################################
## Gettext
ALL_LINGUAS="fr"
AC_SUBST(ALL_LINGUAS)

AM_GNU_GETTEXT([external])
AM_GNU_GETTEXT_VERSION(0.14.1)

#####################################################################
## Fill in flags

requirements="evas ecore edje"

AC_SUBST(requirements)

AC_SUBST(packagesrcdir)

#####################################################################
## Output

AC_OUTPUT([
Makefile
etk.spec
etk.pc
src/Makefile
src/lib/Makefile
src/bin/Makefile
data/Makefile
data/themes/Makefile
data/themes/default/Makefile
data/themes/default/widgets/Makefile
data/themes/default/fonts/Makefile
data/themes/default/images/Makefile
data/themes/default/macros/Makefile
data/fonts/Makefile
data/images/Makefile
data/icons/Makefile
data/icons/default/icons/Makefile
data/icons/default/icons/16x16/Makefile
data/icons/default/icons/16x16/actions/Makefile
data/icons/default/icons/16x16/apps/Makefile
data/icons/default/icons/16x16/categories/Makefile
data/icons/default/icons/16x16/devices/Makefile
data/icons/default/icons/16x16/emblems/Makefile
data/icons/default/icons/16x16/emotes/Makefile
data/icons/default/icons/16x16/mimetypes/Makefile
data/icons/default/icons/16x16/places/Makefile
data/icons/default/icons/16x16/status/Makefile
data/icons/default/icons/22x22/Makefile
data/icons/default/icons/22x22/actions/Makefile
data/icons/default/icons/22x22/apps/Makefile
data/icons/default/icons/22x22/categories/Makefile
data/icons/default/icons/22x22/devices/Makefile
data/icons/default/icons/22x22/emblems/Makefile
data/icons/default/icons/22x22/emotes/Makefile
data/icons/default/icons/22x22/mimetypes/Makefile
data/icons/default/icons/22x22/places/Makefile
data/icons/default/icons/22x22/status/Makefile
data/icons/default/icons/48x48/Makefile
data/icons/default/icons/48x48/actions/Makefile
data/icons/default/icons/48x48/apps/Makefile
data/icons/default/icons/48x48/categories/Makefile
data/icons/default/icons/48x48/devices/Makefile
data/icons/default/icons/48x48/emblems/Makefile
data/icons/default/icons/48x48/emotes/Makefile
data/icons/default/icons/48x48/mimetypes/Makefile
data/icons/default/icons/48x48/places/Makefile
data/icons/default/icons/48x48/status/Makefile
data/icons/default/Makefile
po/Makefile
intl/Makefile
etk-config
debian/changelog
],[
chmod +x etk-config
])

#####################################################################
## Info

echo
echo
echo
echo "------------------------------------------------------------------------"
echo "$PACKAGE $VERSION"
echo "------------------------------------------------------------------------"
echo
echo
echo "Configuration Options Summary:"
echo
echo "  Ecore_X support..............: $have_ecore_x"
echo
echo "Installation Path.........: $prefix"
echo
echo "Now type 'make' ('gmake' on some systems) to compile $PACKAGE,"
echo "and then afterwards as root (or the user who will install this), type"
echo "'make install'. Change users with 'su' or 'sudo' appropriately."
echo
