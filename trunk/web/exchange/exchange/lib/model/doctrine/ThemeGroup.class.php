<?php

/**
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ThemeGroup extends BaseThemeGroup
{
	public static function getAsOptions($application_id = null, $module_id = null)
	{
		$q = new Doctrine_Query();
		$q = $q->select('t.*')
				->from('ThemeGroup t');
		if ($application_id)
			$q = $q->leftJoin('t.ApplicationThemeGroups ag')
					->addWhere('ag.application_id != ? OR ag.id IS NULL', array($application_id));
		elseif ($module_id)
			$q = $q->leftJoin('t.MaduleThemeGroups mg')
					->addWhere('mg.madule_id != ? OR mg.id IS NULL', array($module_id));
		$q = $q->orderBy('t.name ASC');
		$themeGroups = $q->execute();
		$options = array();
		foreach ($themeGroups as $themeGroup)
			$options[$themeGroup->getId()] = $themeGroup->getName();
		return $options;
	}
	
	public static function getByName($name)
	{
		$q = new Doctrine_Query();
		return $q->select('t.*')
					->from('ThemeGroup t')
					->where('name = ?', array($name))
					->execute()
					->getFirst();
	}
	
	public static function getByTitle($title)
	{
		$q = new Doctrine_Query();
		return $q->select('t.*')
					->from('ThemeGroup t')
					->where('title = ?', array($title))
					->execute()
					->getFirst();
	}

	public function getDisplayName()
	{
		if ($this->getTitle())
			return $this->getTitle();
		return $this->getName();
	}

	public function getKnownName()
	{
		if ($this->getKnown())
			return 'Known';
		return 'Unknown';
	}
	
	public function getXML($rss = false)
	{
		if ($rss) {
			$output = 	'<item>' .
							'<title>'.htmlspecialchars($this->getName()).'</title>' .
							'<link>'.htmlspecialchars(Tools::get('url').'/themeGroup/show/'.$this->getId()).'</link>' .
							'<description>'.htmlspecialchars($this->getTitle()).'</description>' .
							'<pubDate>'.date('r', strtotime($this->getUpdatedAt())).'</pubDate>' .
							'<guid>'.htmlspecialchars(Tools::get('url').'/themeGroup/show/'.$this->getId()).'</guid>' .
						'</item>';
		} else {
			$output = '<theme_group>';
			$output .= '<id>'.$this->getId().'</id>';
			$output .= '<name>'.htmlspecialchars($this->getName()).'</name>';
			$output .= '<title>'.htmlspecialchars($this->getTitle()).'</title>';
			$output .= '<known>'.intval($this->getKnown()).'</known>';
			$output .= '<created_at>'.$this->getCreatedAt().'</created_at>';
			$output .= '<updated_at>'.$this->getUpdatedAt().'</updated_at>';
			$output .= '</theme_group>';
		}
		return $output;
	}

	public function save(Doctrine_Connection $conn = null) {
    	if (!$this->exists()) {
			$this->setCreatedAt(date('Y-m-d H:i:s'));
    	}
		$this->setUpdatedAt(date('Y-m-d H:i:s'));
		parent::save($conn);
	}
}