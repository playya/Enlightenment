<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <meta name="keywords" content="Enlightenment, Window, Manager, X Windows,
	 	                 X11, Themes, Efsd, Evas, Imlib">
  <title>W W W . E N L I G H T E N M E N T . O R G</title>
  <link rel="stylesheet" type="text/css" href="stylesheet.css">
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii">
  <style type="text/css">img {behavior: url("png.htc");} </style>
</head>

<body>

<img src="img/banner-top.png" class="banner">

<table border="0" width="100%" cellspacing="0" align="center">
<tr>
<td valign="top">
	<div class="navbar">

<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
  <td valign="top" align="center" width="100%">

<ul class="navsection"><p class="navtitle">Project</p>
<li><a class="navelement" href="main.html">Overview</a>
<li><a class="navelement" href="news.html"><font color=#A36209>News</font></a>
<li><a class="navelement" href="faq.html">FAQ</a>
<li><a class="navelement" href="docs.html">Documentation</a>
<li><a class="navelement" href="http://sourceforge.net/project/showfiles.php?group_id=2">Releases</a>
<li><a class="navelement" href="source.html">Source</a>
<li><a class="navelement" href="support.html">Community</a>
<li><a class="navelement" href="join.html">Join Us!</a>
</ul>

<ul class="navsection"><p class="navtitle">DR16</p>
<li><a class="navelement" href="dr16.html">Enlightenment</a>
<li><a class="navelement" href="imlib.html">Imlib</a>
<li><a class="navelement" href="shots.html">Screenshots</a>
<li><a class="navelement" href="download.html">Get DR16</a>
<li><a class="navelement" href="http://themes.freshmeat.net/browse/60/?topic_id=60">Themes [fm]</a>
</ul>

<ul class="navsection"><p class="navtitle">EFL</p>
<li><a class="navelement" href="efl.html">Overview</a>
<li><a class="navelement" href="imlib2.html">Imlib2</a>
<li><a class="navelement" href="edb.html">Edb</a>
<li><a class="navelement" href="eet.html">EET</a>
<li><a class="navelement" href="evas.html">Evas</a>
<li><a class="navelement" href="ecore.html">Ecore</a>
<!--
<li><a class="navelement" href="epeg.html">EPEG</a>
<li><a class="navelement" href="epsilon.html">Epsilon</a>
<li><a class="navelement" href="embryo.html">Embryo</a>
-->
<!--
<li><a class="navelement" href="ewd.html">EWD</a>
<li><a class="navelement" href="estyle.html">Estyle</a>
-->
<li><a class="navelement" href="etox.html">Etox</a>
<li><a class="navelement" href="edje.html">Edje</a>
<li><a class="navelement" href="ewl.html">EWL</a>
<!-- 
<li><a class="navelement" href="efsd.html">Efsd</a>
-->
</ul>

<ul class="navsection"><p class="navtitle">DR17</p>
<li><a class="navelement" href="enlightenment.html">Enlightenment</a>
<li><a class="navelement" href="elicit.html">Elicit</a>
<li><a class="navelement" href="http://atmos.org/docs/entice/index.html">Entice</a>
<li><a class="navelement" href="http://evidence.sourceforge.net/">Evidence</a>
<li><a class="navelement" href="http://xcomputerman.com/pages/entrance.html">Entrance</a>
<li><a class="navelement" href="http://www.cuddletech.com/">Euphoria</a>
<li><a class="navelement" href="erss.html">eRSS</a>
</ul>

<ul class="navsection"><p class="navtitle">Development</p>
<li><a class="navelement" href="team.html">The Team</a>
<li><a class="navelement" href="http://cia.navi.cx/stats/project/e/.rss">CVS RSS</a>
<li><a class="navelement" href="http://cia.navi.cx/stats/project/e">CIA</a>
<li><a class="navelement" href="http://xcomputerman.com/bugs/login_page.php">BugTrack</a>
<li><a class="navelement" href="logos.html">Logos</a>
<li><a class="navelement" href="links.html">Links</a>
</ul>

<a href="http://sourceforge.net/projects/enlightenment/"><img src="http://sourceforge.net/sflogo.php?group_id=2&amp;type=1" width="88" height="31" border="0" alt="SourceForge Logo"></a>

</td>
</tr>
</table>
</div>

</td>
<td valign="top" width="100%">

<table border="0" cellpadding="0" cellspacing="0" width="100%">
<tr>
  <td valign="top" width="100%">

<div class="content">

<p class="contenttitle">Bug-finding with GDB</p>

<center><h3>GDB - How to use it with Enlightenment</h3></center>
<p>
The most important problem Enlightenment could have is <b>stability</b>.
This will be amply demonstrated when Enlightenment stops and displays a big
gray box in the center of your screen with the title:<br>
<b>"Enlightenment caused Segment Violation (Segfault)"</b><br>
At the bottom of this dialog you will have the choice of ignoring this error,
restarting Enlightenment or Exiting. If you want to help DO NOT BE HASTY at
this point and do not quit, ignore or restart yet... you now have a golden
opportunity to find out what happened and why - Enlightenment is in a paused
state and is ready to be attached to using <b>GDB</b>.
</p><p>
Of course this means you will have had to compile Enlightenment with <b>GDB</b>
debugging enabled... one way to do this is, when compiling Enlightenment,
instead of just typing make use:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
make CFLAGS="-g"
</b></font></pre></td></tr></table>
<p>
Then do the usual <b>make install</b> process. Whenever building Enlightenment
make sure you use this line and make sure the <b>-g</b> flag is set (if you
have another method of doing this please use it - this is just one possible
method).
</p><p>
Now you have Enlightenment stuck after a Segfault. You can easily have <b>GDB</b>
attach to the currently running process with the following:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
~/C/DEV/e/src/ ps -auwx | grep enlightenment
raster   15188  0.0  0.5  4680 3016 ?        S    Aug27   0:18 /usr/local/enlightenment/bin/enlightenment
~/C/DEV/e/src/ gdb /usr/local/enlightenment/bin/enlightenment 15188
</b></font></pre></td></tr></table>
<p>
Notice I pass the executable as the first argument to <b>GDB</b> and the
process ID as the second argument. This will have <b>GDB</b> do something
like:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
GNU gdb 4.17.0.11 with Linux support
Copyright 1998 Free Software Foundation, Inc.
GDB is free software, covered by the GNU General Public License, and you are
welcome to change it and/or distribute copies of it under certain conditions.
Type "show copying" to see the conditions.
There is absolutely no warranty for GDB.  Type "show warranty" for details.
This GDB was configured as "i386-redhat-linux"...

/home/raster/C/DEV/e/src/15188: No such file or directory.
Attaching to program /usr/local/enlightenment/bin/enlightenment', Pid 15188
Reading symbols from /usr/lib/libFnlib.so.0...done.
Reading symbols from /usr/lib/libttf.so.2...done.
Reading symbols from /usr/local/lib/libesd.so.0...done.
Reading symbols from /usr/lib/libaudiofile.so.0...done.
Reading symbols from /lib/libm.so.6...done.
Reading symbols from /usr/local/lib/libImlib.so.1...done.
Reading symbols from /usr/lib/libjpeg.so.62...done.
Reading symbols from /usr/lib/libtiff.so.3...done.
Reading symbols from /usr/lib/libungif.so.4...done.
Reading symbols from /usr/lib/libpng.so.2...done.
Reading symbols from /usr/X11R6/lib/libXext.so.6...done.
Reading symbols from /usr/X11R6/lib/libSM.so.6...done.
Reading symbols from /usr/X11R6/lib/libICE.so.6...done.
Reading symbols from /usr/X11R6/lib/libX11.so.6...done.
Reading symbols from /usr/X11R6/lib/libXtst.so.6...done.
Reading symbols from /usr/lib/libghttp.so.1...done.
---Type &lt return &gt to continue, or q &lt return &gt to quit---
Reading symbols from /lib/libdl.so.2...done.
Reading symbols from /lib/libc.so.6...done.
Reading symbols from /usr/lib/libz.so.1...done.
Reading symbols from /lib/ld-linux.so.2...done.
Reading symbols from /lib/libnss_files.so.2...done.
0x2ad389ee in __select ()
(gdb)
</b></font></pre></td></tr></table>
<p>
It is suggested you do this in a telnet or ssh connection from another
machine, or in a virtual console, as doing it in your current X session running
Enlightenment will pause Enlightenment and ensure Enlightenment cannot
change focus or move windows or anything - it will be frozen.
</p><p>
So now you are able to investigate what happened. A quick list of commands
you should type in at this point to give us useful information are:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
bt (dump a stack trace)
fr 10 (go to stack frame 10 - it is a good idea to go to the frame just before
       the first (bottom-most) HandleSigSegv was called as this is the handler
       being called, not the actual bug)
l (list program code around point)
p variable (print value of variable)
p *variable (print whatever the variable points to if it's a pointer)
</b></font></pre></td></tr></table>
<p>
You will need to actually know some C and code principles to make any sensible
use of the print commands, but knowing what the value of variables was when
things died is very important, as this will give information as to the state
at the time.
</p><p>
Sending all the output of gdb when you have a bug is a very good idea - it
helps use much more quickly find the problem - we often do exactly this
procedure above ourselves, and it speeds up debugging considerably.
</p><p>
Now there may be problems you run into - like the Enlightenment's stack being
corrupted. You know this is the case when function call names in the stack 
backtrace are:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
(??)
</b></font></pre></td></tr></table>
<p>
If this is the case you cannot find much interesting in this state. You will
have to note exactly how you produced the bug and attempt to reproduce it -
if you cannot you may have to give up at this point, or you could with
paranoia always attach to gdb right after enlightenment spawns, just in
case. You will need to run enlightenment and <b>GDB</b> attach <b>BEFORE</b> 
Enlightenment has problems - <b>GDB</b> will intercept the Segfault hopefully 
before the stack corrupts. At this point you may get a more intelligible 
stack dump. Remember if you attach before anything went wrong use the
<b>cont</b> command to let the now stopped program continue running. If you
have become familiar with Enlightenment's source code, you can set
breakpoints with:
</p>
<table border=0><tr><td bgcolor=#ffffff><pre><font color=#000000><b>
br function_name (break whenever function_name function is called)
br file.c:344 (break whenever line 344 in file.c is reached)
d 1 (delete breakpoint 1 (br commands return numbers that are the breakpoint
     numbers)
cont (continue after a break)
</b></font></pre></td></tr></table>
<p>
It is these <b>GDB</b> sessions that will give valuable information in finding
bugs and problems in Enlightenment as it is developed. Please help us - even
if you can't write code, learning a little C and doing the above will help
immensely.</p>

</td>
</tr>
</table>
</td>
</tr></table>
</div> <!-- Close the content div -->

</body></html>

