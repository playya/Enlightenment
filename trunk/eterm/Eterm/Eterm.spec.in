%define ver      @VERSION@
%define rel      1
%define prefix   @prefix@

Summary: Enlightened terminal emulator
Name: Eterm
Version: %{ver}
Release: %{rel}
Copyright: GPL
Group: Utilities/Terminal
Source: ../SOURCES/Eterm-%{ver}.tar.gz
BuildRoot: /tmp/Eterm-root/
URL: http://www.eterm.org/
Requires: imlib, libjpeg, libtiff, libungif, libpng, zlib, XFree86-libs
Packager: Todd Nemanich <trnemani@eos.ncsu.edu>

%ifarch i386
%description
This is an rpm of Eterm, a highly configurable and asethically pleasing
terminal emulator.

This rpm was optimized for i486 and was built without support
for libKenny.so.
(Egads! They killed Kenny! You bastards!)
%else
%description
This is an rpm of Eterm, a highly configurable and asethically pleasing
terminal emulator. 

This rpm contains no architecture specific optimizations, and
was built without support for libKenny.so. 
(Egads! They killed Kenny! You bastards!)
%endif

%changelog
* Sun Jun 6 1999 Todd Nemanich <trnemani@eos.ncsu.edu>
- Updated rpm to incorporate a few fixes for different architectures,
- specify /usr/local/share/Eterm/themes/* as config files, and 
- a fix for the share directory problem.

* Tue Apr 27 1999 Todd Nemanich <trnemani@eos.ncsu.edu>
- Updated to version 8.9. Added a check to make sure /usr/local/lib
- is in /etc/ld.so.conf because too many people don't know how
- ld works.
- Also moving, so new email address for me.
 
* Sat Jan 23 1999 Todd Nemanich <tick@speak.rh.ncsu.edu>
- Updated to version 8.8

* Sat Oct 23 1998 Todd Nemanich <tick@speak.rh.ncsu.edu>
- Updated to version 0.8.7. A minor change in the Makefiles was made by hand,
- due to a linkinkg problem. This should not cause problems to people using the
- source rpm, but the call to configure has been removed.

* Mon Sep 21 1998 Todd Nemanich <tick@speak.rh.ncsu.edu>
- Bad link in /usr/local/bin corrected. THX to Andy Dustman for pointing this out.

%prep
rm -fr $RPM_BUILD_ROOT $RPM_BUILD_DIR/Eterm-%{ver}
mkdir $RPM_BUILD_ROOT
cd $RPM_BUILD_DIR
tar -xzf $RPM_SOURCE_DIR/Eterm-%{ver}.tar.gz 

%build
cd $RPM_BUILD_DIR/Eterm-%{ver}
./configure --prefix=%{prefix}
%ifarch i386
make "CFLAGS=-O3 -m486 -malign-loops=2 -malign-jumps=2 -malign-functions=2"
%else
make
%endif

%install
cd $RPM_BUILD_DIR/Eterm-%{ver}
make prefix=$RPM_BUILD_ROOT%{prefix} install



%postinst
LDPATH=`grep local /etc/ld.so.conf`

if [ "$LDPATH" = "" ] ; then
        NEW='/usr/local/lib'
        cat /etc/ld.so.conf >ld.tmp
        echo "$NEW">>new.ld
        cat ld.tmp new.ld > ld.so.conf
        mv ld.so.conf /etc/ld.so.conf
        rm -f new.ld ld.tmp
fi

/sbin/ldconfig

%clean
rm -fr $RPM_BUILD_ROOT $RPM_BUILD_DIR/Eterm-%{ver}

%files
%defattr(-,root,root)
%doc $RPM_BUILD_DIR/Eterm-%{ver}/README 
%doc $RPM_BUILD_DIR/Eterm-%{ver}/COPYING 
%doc $RPM_BUILD_DIR/Eterm-%{ver}/ChangeLog 
%doc $RPM_BUILD_DIR/Eterm-%{ver}/ReleaseNotes 
%doc $RPM_BUILD_DIR/Eterm-%{ver}/CVS-README
%doc $RPM_BUILD_DIR/Eterm-%{ver}/doc/*
%doc %{prefix}/man
%config %{prefix}/share/Eterm/themes/
%{prefix}/bin
%{prefix}/lib
