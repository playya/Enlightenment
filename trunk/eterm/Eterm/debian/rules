#!/usr/bin/make -f

export DH_COMPAT=2

vpath build debian
vpath install debian
cfg = --prefix=/usr --mandir=/usr/share/man

build:
	dh_testdir
	test -x autogen.sh && ./autogen.sh $(cfg)  || ./configure $(cfg)

	# because glibc 2.1's utmpx.h is incompatible on sparc
	sed 's/#define HAVE_UTMPX_H 1/\/* #undef HAVE_UTMPX_H *\//' config.h > config.h.tmp
	mv config.h.tmp config.h

	# fix rpath issues
	cp libtool libtool-2
	sed \
	-e 's/^hardcode_libdir_flag_spec.*$$/hardcode_libdir_flag_spec="-D__LIBTOOL_IS_A_FOOL__ "/' \
	-e '/^archive_cmds="/s/"$$/ \\$$deplibs"/' libtool-2 > libtool
	$(MAKE)
	touch debian/$@

clean:
	dh_testdir
	dh_testroot
	rm -f build-stamp
	test -f Makefile && $(MAKE) -k distclean
	dh_clean debian/{build,install,libtool-2}

install: build
	dh_testdir 
	dh_testroot 
	dh_clean 
	dh_installdirs 
	$(MAKE) install DESTDIR=$(shell pwd)/debian/eterm
	touch debian/$@

binary-arch: build install
	dh_testdir 
	dh_testroot 
	dh_installdocs README ReleaseNotes doc/{FAQ.html,Eterm.tcap,Eterm.ti,Eterm_reference.html}
	dh_installmenu 
	dh_undocumented  Esetroot.1 Etbg.1 Etcolors.1 Ettable.1 Etwinop.1
	dh_installchangelogs 
	dh_strip 
	dh_compress 
	dh_fixperms 
	dh_suidregister usr/bin/Eterm
	dh_installdeb 
	dh_makeshlibs
	dh_shlibdeps 
	dh_gencontrol 
	dh_md5sums 
	dh_builddeb 

binary-indep:

binary: binary-arch

.PHONY: clean binary-indep binary-arch binary
