From 390afe1f9d89fccb201c454153b8c6268e03cfe7 Mon Sep 17 00:00:00 2001
From: Carsten Haitzler <raster@openmoko.org>
Date: Tue, 14 Apr 2009 20:18:10 +1000
Subject: [PATCH] e2fsprogs: fix compile to use 3 args so it works.

---
 .../e2fsprogs/e2fsprogs-1.38/file-open-mode.patch  |   11 +++++++++++
 recipes/e2fsprogs/e2fsprogs-native_1.38.bb         |    5 +++--
 recipes/e2fsprogs/e2fsprogs_1.38.bb                |    5 +++--
 3 files changed, 17 insertions(+), 4 deletions(-)
 create mode 100644 recipes/e2fsprogs/e2fsprogs-1.38/file-open-mode.patch

diff --git a/recipes/e2fsprogs/e2fsprogs-1.38/file-open-mode.patch b/recipes/e2fsprogs/e2fsprogs-1.38/file-open-mode.patch
new file mode 100644
index 0000000..97679d6
--- /dev/null
+++ b/recipes/e2fsprogs/e2fsprogs-1.38/file-open-mode.patch
@@ -0,0 +1,11 @@
+--- e2fsprogs-1.38/lib/ext2fs/ismounted.c~	2005-06-06 06:05:22.000000000 +1000
++++ e2fsprogs-1.38/lib/ext2fs/ismounted.c	2009-04-03 15:07:35.000000000 +1100
+@@ -147,7 +147,7 @@
+ is_root:
+ #define TEST_FILE "/.ismount-test-file"		
+ 		*mount_flags |= EXT2_MF_ISROOT;
+-		fd = open(TEST_FILE, O_RDWR|O_CREAT);
++		fd = open(TEST_FILE, O_RDWR|O_CREAT, S_IRUSR|S_IWUSR);
+ 		if (fd < 0) {
+ 			if (errno == EROFS)
+ 				*mount_flags |= EXT2_MF_READONLY;
diff --git a/recipes/e2fsprogs/e2fsprogs-native_1.38.bb b/recipes/e2fsprogs/e2fsprogs-native_1.38.bb
index 388c519..af49b0d 100644
--- a/recipes/e2fsprogs/e2fsprogs-native_1.38.bb
+++ b/recipes/e2fsprogs/e2fsprogs-native_1.38.bb
@@ -2,11 +2,12 @@ SECTION = "base"
 require e2fsprogs.inc
 inherit native
 
-PR = "r2"
+PR = "r3"
 
 SRC_URI += "file://no-hardlinks.patch;patch=1 \
 	    file://mkinstalldirs.patch;patch=1 \
-	   "
+            file://file-open-mode.patch;patch=1 \
+            "
 
 EXTRA_OECONF = ""
 
diff --git a/recipes/e2fsprogs/e2fsprogs_1.38.bb b/recipes/e2fsprogs/e2fsprogs_1.38.bb
index 5687556..8ec469a 100644
--- a/recipes/e2fsprogs/e2fsprogs_1.38.bb
+++ b/recipes/e2fsprogs/e2fsprogs_1.38.bb
@@ -1,10 +1,11 @@
 require e2fsprogs.inc
 
-PR = "r19"
+PR = "r20"
 
 SRC_URI += "file://no-hardlinks.patch;patch=1 \
 	    file://mkinstalldirs.patch;patch=1 \
-	   "
+            file://file-open-mode.patch;patch=1 \
+           "
 
 TARGET_CC_ARCH += "${LDFLAGS}"
 
-- 
1.5.6.3

