#!/bin/sh -e

DB="/etc/entrance_config.cfg"

usage() {
	cat <<-EOF
	Usage: $0 [options] [option] [value]

	Options:
	  -c, --file    Config file (default: $DB)
	  -h, --help    This help output
	EOF

	if [ "$1" = "1" ] ; then
		echo ""
		echo "ERROR: $2"
	fi

	exit $1
}

if [ "$(whoami)" != "root" ]; then usage 1 "You are not root."; fi

if [ -z "$(which ecore_config)" ]; then
	usage 1 "Can't find ecore_config."
fi

case $1 in
	-c|--file) $DB=$2; shift; shift
	;;
	-h) usage 0; shift
	;;
esac

if [ -z "$DB" ] || [ -d "$DB" ] ; then
	usage 1 "Invalid DB argument"
fi

if [ -z "$1" ]; then ecore_config -a -c "$DB"; exit 0; fi

type="$(ecore_config -a -c /etc/entrance_config.cfg | grep $1 | awk '{print $2}')"
if [ "$type" = "integer" ]; then
	type="i"
elif [ "$type" = "string" ]; then
	type="s"
elif [ "$type" = "float" ]; then
	type="f"
elif [ "$type" = "theme" ]; then
	type="t"
elif [ "$type" = "rgb" ]; then
	type="r"
elif [ "$type" = "bool" ]; then
	type="b"
elif [ "$(echo $1|egrep '^\/entrance\/session\/\d+\/session')" ] || [ "$(echo $1|egrep '^\/entrance\/session\/\d+\/title')" ] || [ "$(echo $1|egrep '^\/entrance\/session\/\d+\/icon')" ]; then
	type="s"
else
	usage 1 "Wrong value."
fi

ecore_config -c "$DB" -k "$1" -$type "$2"

chmod 644 $DB

exit 0
